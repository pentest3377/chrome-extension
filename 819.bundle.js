"use strict";(self.webpackChunktab_nodes_tree_extension=self.webpackChunktab_nodes_tree_extension||[]).push([[819,864,568],{79868:(e,t,n)=>{n.d(t,{i3:()=>a,yp:()=>o,z2:()=>r});let r=function(e){return e.NextAtRootLevel="NextAtRootLevel",e.SameLevelSibling="SameLevelSibling",e.AsFirstChild="AsFirstChild",e.AsLastChild="AsLastChild",e}({}),a=function(e){return e.AsFirstChild="AsFirstChild",e.AsLastChild="AsLastChild",e}({}),o=function(e){return e.AsFirstChild="AsFirstChild",e.AsLastChild="AsLastChild",e}({})},3022:(e,t,n)=>{n.d(t,{Di:()=>a,T8:()=>i,my:()=>o,o7:()=>s,vJ:()=>r});let r={grey:{color:"#dadce0",textColor:"#000"},blue:{color:"#8ab4f8",textColor:"#000"},red:{color:"#f28b82",textColor:"#000"},yellow:{color:"#fdd663",textColor:"#000"},green:{color:"#81c995",textColor:"#000"},pink:{color:"#ff8bcb",textColor:"#000"},purple:{color:"#c58af9",textColor:"#000"},cyan:{color:"#78d9ec",textColor:"#000"},orange:{color:"#fcad70",textColor:"#000"}},a=100,o=15,i="chrome://extensions/shortcuts";chrome.runtime.getURL("branch-tab-node.html");let s=chrome.runtime.getURL("options.html")},94475:(e,t,n)=>{n.d(t,{S:()=>g});var r=n(62567),a=n(87521),o=n(87855),i=n(93034),s=n(24817),d=n(92935),l=n.n(d),c=n(79868),u=n(65343),h=n(68687);let b=(0,i.tZ)(!0,i.W4.action,g.name);async function g(e,t,n){let i={url:e};switch(n.nodeType){case"tabNode":if(n.pinned)i=Object.assign(Object.assign({},i),{index:n.index+1});else switch(t){case c.z2.SameLevelSibling:i=Object.assign(Object.assign({},i),{openerTabId:n.id,index:(0,s.nJ)(n)});break;case c.z2.AsFirstChild:i=Object.assign(Object.assign({},i),{openerTabId:n.id,index:n.index+1});break;case c.z2.AsLastChild:i=Object.assign(Object.assign({},i),{openerTabId:n.id,index:(0,s.nJ)(n)});break;case c.z2.NextAtRootLevel:i=Object.assign(Object.assign({},i),{openerTabId:n.id,index:(0,s.Z0)(n,a.store.nodesTree.nodes)})}break;case"groupNode":switch(t){case c.z2.AsFirstChild:let d=(0,s.um)(n,a.store.nodesTree.nodes);if(!d){b.error("Cannot find the first child tab node of the group node.");return}i=Object.assign(Object.assign({},i),{index:d.index});break;case c.z2.AsLastChild:let g=(0,s.IB)(n,a.store.nodesTree.nodes);if(!g){b.error("Cannot find the last child tab node of the group node.");return}i=Object.assign(Object.assign({},i),{index:g.index+1});break;case c.z2.SameLevelSibling:case c.z2.NextAtRootLevel:return}}a.store.chromeEventListeners.toggleAllListeners(!1),b.gP("create new tab",{openerNode:n,position:t,createTabProperties:i});try{let e,d;switch(n.nodeType){case"tabNode":if((0,s.y7)(n)){if(b.log('Opener tab is in a group. To avoid "Saved groups are not editable." error when creating a tab with index. We create a tab without index first, then add to the group and move to the right index.',i),e=await chrome.tabs.create(l().pick(i,"url","openerTabId")),b.log("New tab created",e),!e.id)return;await chrome.tabs.group({tabIds:e.id,groupId:n.groupId}),i.index&&await chrome.tabs.move(e.id,{index:i.index})}else{if(e=await chrome.tabs.create(i),b.log("New tab created",e),!e.id)return;e.groupId!==n.groupId&&(b.log("Add to group.",{tabId:e.id,openerNodeGroupId:n.groupId}),await chrome.tabs.group({tabIds:e.id,groupId:n.groupId}))}if(n.pinned)d={oldNodes:a.store.nodesTree.nodes,fixMissingParents:!1};else{let r=(0,h.WB)(a.store.nodesTree.nodes,n,!0);switch(t){case c.z2.SameLevelSibling:d={oldNodes:r,fixMissingParents:!1,nodesWithNewProperties:{[e.id]:{ancestralNodeIds:(0,u.c)(n,{includeOpenerTabNode:!1})}}};break;case c.z2.AsFirstChild:case c.z2.AsLastChild:d={oldNodes:r,fixMissingParents:!1,nodesWithNewProperties:{[e.id]:{ancestralNodeIds:(0,u.c)(n,{includeOpenerTabNode:!0})}}};break;case c.z2.NextAtRootLevel:d={oldNodes:r,fixMissingParents:!1}}}break;case"groupNode":if(e=await chrome.tabs.create(i),b.log("New tab created",e),!e.id)return;switch(e.groupId!==n.id&&(b.log("Add to group.",{tabId:e.id,openerNodeGroupId:n.id}),await chrome.tabs.group({tabIds:e.id,groupId:n.id})),d={oldNodes:(0,h.WB)(a.store.nodesTree.nodes,n,!0),fixMissingParents:!1},t){case c.z2.AsFirstChild:case c.z2.AsLastChild:case c.z2.SameLevelSibling:case c.z2.NextAtRootLevel:}}d&&o.s.pushAsync({logger:b,run:async()=>{await (0,r.O)(d)}})}catch(e){b.error(e)}finally{b.ge(),a.store.chromeEventListeners.toggleAllListeners(!0)}}},56615:(e,t,n)=>{n.d(t,{fL:()=>c,getChromeCurrentWindowId:()=>i,hs:()=>l,mR:()=>b});var r=n(93034);async function a(e,t,n){let r=getLogger(!0,LogTagStyleType.script,a.name);r.gP({movingTabs:e,toIndex:t}),n&&store.chromeEventListeners.toggleAllListeners(!1);try{let n=e.filter(e=>e.index<t).length;for(let a=0;a<e.length;a++){let o=e[a],i=t;o.index<t?(r.log(`Fix moving tab downwards tab will be removed first causing 1 index less in total. movingTabNode.index(${o.index}) < toIndex(${t}), fix ToIndex by toIndex - 1 (${t-1})`),i-=1):i+=a-n,await chrome.tabs.move(o.id,{index:i})}}catch(e){r.errorP(e)}finally{n&&store.chromeEventListeners.toggleAllListeners(!0),r.ge()}}async function o(){try{return await chrome.windows.getCurrent()}catch(e){throw Error(`getChromeCurrentWindow error:. Unable to get current window. Error: ${e.message}`)}}async function i(){try{return(await o()).id}catch(e){throw Error(`getChromeCurrentWindowId error: Unable to get current window id. Error: ${e.message}`)}}async function s(e){let t=(0,r.tZ)(!1,r.W4.script,s.name);t.gP({windowId:e});try{if(e||(t.log("Window is undefined. Get current window id."),e=await i()),!e)throw Error("windowId is undefined.");let n=await chrome.tabs.query({windowId:e});return t.log({chromeTabs:n}),n}catch(e){throw e}finally{t.ge()}}async function d(e){let t=(0,r.tZ)(!1,r.W4.script,d.name);t.gP({windowId:e});try{if(e||(t.log("Window is undefined. Get current window id."),e=await i()),!e)throw Error("windowId is undefined.");let n=await chrome.tabGroups.query({windowId:e});return t.log({chromeGroups:n}),n}catch(e){throw e}finally{t.ge()}}async function l(e){return await Promise.all([s(e),d(e)]).then(([e,t])=>({chromeTabs:e,chromeTabGroups:t}))}async function c(e){return(await chrome.windows.getAll()).some(t=>t.id===e)}n(53775),n(87521),n(3022),n(92935),n(24817),n(53233),n(37390),n(57866);var u=function(e){return e.ReplaceNewPageTabWithExtensionPageTabAtBottom="ReplaceNewPageTabWithExtensionPageTabAtBottom",e.ReplaceNewPageTabWithExtensionPageTab="ReplaceNewPageTabWithExtensionPageTab",e.RestoreExtensionTabAtOriginalIndex="RestoreExtensionTabAtOriginalIndex",e}(u||{});function h(e){return e.groupId!==chrome.tabGroups.TAB_GROUP_ID_NONE}function b(e,t){var n,r,a;return null!==(a=(null===(n=e.url)||void 0===n?void 0:n.startsWith(t))||(null===(r=e.pendingUrl)||void 0===r?void 0:r.startsWith(t)))&&void 0!==a&&a}},37390:(e,t,n)=>{n.d(t,{GG:()=>s,Gq:()=>g,J8:()=>u,Jx:()=>d,Lp:()=>p,Pj:()=>l,SG:()=>h,SR:()=>c,cX:()=>m,eC:()=>f,nH:()=>a,r$:()=>b,ud:()=>i,yy:()=>o}),n(79474);var r=n(93034);function a(e,t,n=!0){let r=Object.getOwnPropertyDescriptor(e,t);return r?!!r.writable:n}async function o(e){return new Promise(t=>setTimeout(t,e))}function i(){return window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches}function s(e,t){return Object.values(t).includes(e)}function d(e,t,n){let a=(0,r.tZ)(!0,r.W4.script,d.name);a.gcP("Check data",{defaultData:(0,r.mm)(e),currentData:(0,r.mm)(t)}),Object.isFrozen(t)&&(a.log("currentData is frozen. Clone it."),t=structuredClone(t));let o=function e(t,n,a){let o=(0,r.tZ)(!0,r.W4.script,e.name);if("object"!=typeof t||null===t)return o.return("defaultData is not object or null. Return it."),t;if("object"!=typeof n||null===n)return o.return("currentData is not object or null. Return it."),t;let i=Object.assign({},t);for(let t in o.gcP("Compare two data.",{path:a,defaultDataClone:(0,r.mm)(i),currentData:(0,r.mm)(n)}),n){let r=a?`${a}.${t}`:t,s="default",d="current";o.search("Check data with key.",{path:r,[`${s}`]:i[t],[`${d}`]:n[t]}),n.hasOwnProperty(t)&&(i.hasOwnProperty(t)?"object"==typeof i[t]&&"object"==typeof n[t]?Array.isArray(i[t])&&!Array.isArray(n[t])?(o.update(`${s} is an array, but ${d} is not. Replace old data with new data.`),n[t]=i[t]):!Array.isArray(i[t])&&Array.isArray(n[t])?(o.update(`${s} is an object but ${d} is an array. Replace old data with new data.`),n[t]=i[t]):Array.isArray(i[t])&&Array.isArray(n[t])?o.success(`${s} and ${d} both are array. No need to process.`):(o.deep(`${s} and ${d} are object. Recursively check it.`),n[t]=e(i[t],n[t],r)):void 0===i[t]||null===i[t]?o.skip(`${s} is either undefined or null. Skip it.`):typeof n[t]!=typeof i[t]?(o.update(`${s} and ${d} are different type. Replace old data with new data.`),n[t]=i[t]):o.success(`${s} and ${d} are the same data type.`):(o.bin(`${s} === undefined, but ${d} has it. Remove it.`),delete n[t])),delete i[t]}for(let e in o.ge(),o.g(`Check missing properties. There are ${Object.keys(i).length} properties could be missing.`,{defaultDataClone:i}),i){let t=a?`${a}.${e}`:e,r="current";o.search("Check data with key.",{path:t,default:i[e],[`${r}`]:n[e]}),i.hasOwnProperty(e)&&!n.hasOwnProperty(e)&&void 0!==i[e]&&(o.update(`${r} is missing. Fill it.`),n[e]=i[e])}return o.ge(),n}(e,t,n);return a.ge(),o}function l(e,t,n){if(t<0||t>=e.length||n<0||n>=e.length)throw Error("Invalid index");let r=[...e],[a]=r.splice(t,1);return r.splice(n,0,a),r}function c(){return"object"==typeof self&&self.constructor&&"ServiceWorkerGlobalScope"===self.constructor.name}function u(e,t,n,r,a){return function(e,t,n,r,a){let o=new Set(n);return e.filter(e=>{var n,i;return"include"===t?o.has(e[r])&&(null===(n=null==a?void 0:a(e))||void 0===n||n):!o.has(e[r])&&!(null==a?void 0:a(e))})}(e,t,n.map(e=>e[r]),r,a)}function h(){var e;let t;try{t=window.location}catch(e){}try{t||(t=location)}catch(e){}if(t){let n=null===(e=t.pathname)||void 0===e?void 0:e.split(".");if(n.length>0){let e=n[0].replace("/","");return"background"===e?"SW":e}}return""}function b(e,t,n){let{ifPrint:a=!1,printType:o="unequal",ifPrintComparingDetails:i=!1,logTags:s=[]}=null!=n?n:{},d=(0,r.tZ)(a,r.W4.script,[...f(s),b.name]),l=g(e,t,{log:{ifPrint:i,tags:s},stopOnFirstDifference:!0});return Object.keys(l).length>0?d.failureP("Not equal.",{obj1:e,obj2:t,differences:l}):"equalAndUnequal"===o&&d.successP("Are equal.",{obj1:e,obj2:t}),0===Object.keys(l).length}function g(e,t,n){let{log:a={ifPrint:!1,tags:[]},stopOnFirstDifference:o=!1}=null!=n?n:{},{ifPrint:i,tags:s}=a,d=Array.isArray(s)?s:[s],l=(0,r.tZ)(i,r.W4.script,[...d,g.name]);l.gP({obj1:e,obj2:t});let c=function e(t,n,r){let{logger:a,stopOnFirstDifference:o=!1}=r,i={};if(Array.isArray(t)&&Array.isArray(n)){a.loop("Both are arrays. Loop through each element to compare.");for(let s=0;s<t.length;s++)if(s<n.length){a.g(`Compare array1[${s}] and array2[${s}]`,{index:s,[`array1[${s}]`]:t[s],[`array2[${s}]`]:n[s]});let d=e(t[s],n[s],r);if(a.ge(),0!==Object.keys(d).length&&(i[s.toString()]=d,o))return i}else if(a.check(`array1[${s}] is not in array2[${s}]`,{index:s,[`array1[${s}]`]:t[s],[`array2[${s}]`]:n[s]}),i[s.toString()]=[t[s],void 0],o)return i;for(let e=t.length;e<n.length&&(a.check(`array2[${e}] element is not in array1[${e}]`,{index:e,[`array1[${e}]`]:t[e],[`array2[${e}]`]:n[e]}),i[e.toString()]=[void 0,n[e]],!o);e++);}else if(Array.isArray(t)&&!Array.isArray(n))return a.check("obj1 is an array, but obj2 is not"),[t,n];else if(!Array.isArray(t)&&Array.isArray(n))return a.check("obj1 is not an array, but obj2 is"),[t,n];else if("object"!=typeof t||"object"!=typeof n)t!==n&&(a.check("Either obj1 or obj2 is not an object.",{obj1Type:typeof t,obj2Type:typeof n}),i={obj1:t,obj2:n});else{for(let s in t)if(s in n){if("object"==typeof t[s]&&null!==t[s]){a.g(`Check obj1[${s}] and obj2[${s}]`,{[`obj1[${s}]`]:t[s],[`obj2[${s}]`]:n[s]});let d=e(t[s],n[s],r);if(a.ge(),0!==Object.keys(d).length&&(i[s]=d,o))return i}else if(t[s]!==n[s]&&(a.check(`obj1[${s}] !== obj2[${s}]`,{[`obj1[${s}]`]:t[s],[`obj2[${s}]`]:n[s]}),i[s]=[t[s],n[s]],o))return i}else if(a.check(`key:${s} is not in obj2`,{[`obj1[${s}]`]:t[s],[`obj2[${s}]`]:n[s]}),i[s]=[{[s]:t[s]},void 0],o)return i;for(let e in n)if(!(e in t)&&(a.check(`key:${e} is not in obj1`,{[`obj1[${e}]`]:t[e],[`obj2[${e}]`]:n[e]}),i[e]=[void 0,{[e]:n[e]}],o))break}return i}(e,t,{logger:l,stopOnFirstDifference:o});return l.ge(),c}function f(e){return e?Array.isArray(e)?e:[e]:[]}function p(e,t,n){let r=n,a=`${t}${r}`;for(;e.includes(a);)r=`${r}${n}`,a=`${t}${r}`;return a}function m(){var e,t,n;return!!navigator&&((null===(t=null===(e=null==navigator?void 0:navigator.userAgentData)||void 0===e?void 0:e.platform)||void 0===t?void 0:t.toUpperCase())==="MACOS"||(null===(n=navigator.platform)||void 0===n?void 0:n.toUpperCase().includes("MAC")))}n(65640)},53775:(e,t,n)=>{n.d(t,{wn:()=>s});var r=n(94475),a=n(24817),o=n(79868),i=n(27207);function s(e,t){return t instanceof Error?"Saved groups are not editable."===t.message?(0,i.FD)(i.FK,{children:["Saved groups are not editable.",(0,i.Y)("a",{rel:"noreferrer",target:"_blank",className:"hover:underline underline ml-2",href:"https://github.com/Able-Bear-Software/tab-nodes-tree/discussions/7",onClick:async t=>{let n=(0,a.Id)(e);n&&(t.preventDefault(),await (0,r.S)("https://github.com/Able-Bear-Software/tab-nodes-tree/discussions/7",o.z2.SameLevelSibling,n))},children:"What is this?"})]}):t.message:t}},83246:(e,t,n)=>{n.d(t,{Gt:()=>L,Kj:()=>j,pR:()=>O,pu:()=>S,t2:()=>A,xd:()=>R});var r=n(69173),a=n(68928),o=n.n(a),i=n(31997),s=n.n(i),d=n(60047),l=n.n(d),c=n(2530),u=n(84590),h=n(67272),b=n(43393),g=n(87521),f=n(44788),p=n(93034),m=n(54510),y=n(61566),N=n(27566),w=n(78154);n(35904);var I=n(94778),v=n(6320),C=n(37390),T=n(59721),x=n(65640);async function A(){return await k(window.location.pathname)}async function k(e,t=!1){let n;let r=(0,p.tZ)(c.A.logLicenseValidation,p.W4.script,[...(0,C.eC)(e),k.name]);r.gP("Get license data from Chrome local storage.");try{let e=await m.g.loadData();if(r.log("Encrypted license data retrieved from Chrome local storage.",{encryptedLicenseData:e}),e){let t;if(t=await (0,y.af)(e))try{n=JSON.parse(t)}catch(e){r.error("Unable to convert license data to JSON. Data might be broken.",e)}}}catch(n){let e="Failed to decrypt license data. It might be compromised.";if(await h.ga.fireExceptionEvent({from:"service worker",when:"Decrypt license data.",details:e,error:n.message}),r.error(e,n),t)throw n}finally{r.ge()}return n||(n=E(),await O(e,n)),n}function E(e){return{deviceId:null!=e?e:(0,r.Ak)(),entitlement:u.h.FREE}}async function O(e,t){let n=(0,p.tZ)(c.A.logLicenseValidation,p.W4.script,[...(0,C.eC)(e),O.name]);n.gP("Saving license. Disable listener to avoid dead loops or unexpected behavior.",t);try{await N.X7.disableListener(w.HR.SERVICE_WORKER),await N.F2.disableListener(w.x7.SERVICE_WORKER);let r=await (0,y.yv)(JSON.stringify(t));await m.g.save(r),n.log("License data encrypted and saved to Chrome storage."),await P(e,t),R(t)||(n.log("License is not pro, disable PRO features."),await S())}catch(e){n.error("Save license data error.",e)}finally{n.ge(),await N.X7.enableListener(w.HR.SERVICE_WORKER),await N.F2.enableListener(w.x7.SERVICE_WORKER)}}async function P(e,t){let n=(0,p.tZ)(c.A.logLicenseValidation,p.W4.script,[...(0,C.eC)(e),P.name]);n.gP("Notify license changes.",t);try{(0,C.SR)()||g.store.licenseCache.setLicenseCache(t),n.log("Send a message to notify pages to update license cache."),await (0,f.w)({type:"setLicenseCacheState",license:t},{logTags:e,onLogFailure:()=>n.falseP("No active listeners.")})}catch(e){n.error("Notify license changes.",e)}finally{n.ge()}}async function S(){await I.O.updateOptions(e=>{$(e)}),await (0,f.w)({type:"previewNodesTheme",previewNodesTheme:void 0})}async function $(e){let t=(0,p.tZ)(c.A.logLicenseValidation,p.W4.script,[$.name]);if(Object.isFrozen(e))return t.errorP("Options is frozen. Cannot update."),!1;let n=!1;return e.themeSettings.customizedTabNodesTreeThemeSettings.enabled&&(e.themeSettings.customizedTabNodesTreeThemeSettings.enabled=!1,n=!0),e.nodesTreeSettings.newTabNodePositionExternalLinkSetting!==T.qS.ChromeDefault&&(e.nodesTreeSettings.newTabNodePositionExternalLinkSetting=T.qS.ChromeDefault,n=!0),e.nodesTreeSettings.newTabNodePositionBookmarkSetting!==T.B8.ChromeDefault&&(e.nodesTreeSettings.newTabNodePositionBookmarkSetting=T.B8.ChromeDefault,n=!0),e.nodesTreeSettings.whichTabNodeToActivateAfterTabNodeClosedSettings.settingType!==v.WQ.ChromeDefault&&(e.nodesTreeSettings.whichTabNodeToActivateAfterTabNodeClosedSettings.settingType=v.WQ.ChromeDefault,n=!0),n}async function j(e,t){let n=Array.isArray(e)?e:[e],r=E(t);return await O(n,r),r}function L(e,t){return function(e,t=()=>{}){return function(e,t,n=()=>{}){return e!==u.h.PRO||g.store.licenseCache.isValidProEntitlement?t:n}(u.h.PRO,e,t)}(e,()=>{t&&h.ga.fireEvent2({name:h.U.UNEXPECTED_EVENT_WITHOUT_PRO_ENTITLEMENT,event:t}).catch(x.error)})}function R(e){var t;let n;return t=u.h.PRO,n=!1,t===u.h.PRO&&e.entitlement===u.h.PRO&&(n=!0),n&&!!e.status&&[b.UI.ACTIVE,b.UI.EXPIRING].includes(e.status)}o().extend(s()),o().extend(l())},2613:(e,t,n)=>{n(93034),n(24817)},24508:(e,t,n)=>{n(56615),n(93034),n(37390),n(3735),n(44788)},24817:(e,t,n)=>{n.d(t,{IB:()=>O,IC:()=>T,Id:()=>A,LD:()=>y,Op:()=>N,SQ:()=>P,Sh:()=>g,UW:()=>v,Z0:()=>b,ZO:()=>k,aL:()=>C,fc:()=>l,gJ:()=>w,j7:()=>f,nJ:()=>h,q8:()=>x,u:()=>c,um:()=>E,y7:()=>I,zv:()=>m});var r=n(2531),a=n(37390);n(2613);var o=n(3022),i=n(93034),s=n(2530),d=n(56615);function l(e){return e.filter(e=>x(e))}function c(e,t){let n=(0,i.tZ)(!1,i.W4.script);n.gt({nodes:(0,i.mm)(e)});let r=l(e);r.reduce((e,n,a,o)=>((function e(t,n,r,a){var o,s;let l=(0,i.tZ)((0,d.mR)(n,"https://www.reddit.com/r/cats/")&&!0,i.W4.script,[e.name]);l.gP("Loop above nodes until nodeIndex < 0, or found first ancestor, and include it and its ancestralNodeIds as tabNode's ancestralNodeIds",{"tabNode.title":n.title,"tabNode.index":r,tabNode:(0,i.mm)(n)});let c=r-1,h=n.ancestralNodeIds.slice(),b=()=>{l.update({from:h,to:n.ancestralNodeIds})};if(c<0)l.start(`currentNodeIndex(${c}) < 0. This means this tab node is the top node in the tree. tabNode.ancestralNodeIds should be empty. Check it.`),h.length>0?(l.check("tabNode.ancestralNodeIds is not empty. Empty it."),n.ancestralNodeIds=[],u(t,n),b()):l.false("tabNode.ancestralNodeIds is empty. Do nothing.");else{l.gls("Start to check tab node above it.");let e=!1;for(;c>=0;){let r=t[c];l.start("currentNode",{currentNodeIndex:c,"currentTabNode.title":r.title,currentTabNode:(0,i.mm)(r)});let d=r.groupId!==chrome.tabGroups.TAB_GROUP_ID_NONE,h=n.groupId!==chrome.tabGroups.TAB_GROUP_ID_NONE;if(d&&!h){e||0===n.ancestralNodeIds.length||(l.check("currentTabNode is in a group, but tabNode is not in a group, empty tabNode.ancestralNodeIds."),n.ancestralNodeIds=[],u(t,n),b()),l.stop("End.");break}if(!d&&h){e||0===n.ancestralNodeIds.length||(l.check("currentTabNode is not in a group, but tabNode is in a group, empty tabNode.ancestralNodeIds."),n.ancestralNodeIds=[],u(t,n),b()),l.stop("End.");break}if(d&&h&&r.groupId!==n.groupId){e||0===n.ancestralNodeIds.length||(l.check("currentTabNode is in a group, but tabNode is not in the same , empty tabNode.ancestralNodeIds."),n.ancestralNodeIds=[],u(t,n),b()),l.stop("End.");break}if(!e){let i=n.ancestralNodeIds.includes(null!==(o=r.previousTabId)&&void 0!==o?o:-1);if(r.id&&n.ancestralNodeIds.includes(r.id)||i){let o=n.ancestralNodeIds[0]!==r.id;i?l.check("currentTabNode is an ancestor of tabNode by its previousTabId. Check if tabNode is first child and promoteFirstChildAsParentOnParentClose setting.",{promoteFirstChildAsParentOnParentClose:a}):l.check("currentTabNode is an ancestor of tabNode. Check if tabNode is first child and promoteFirstChildAsParentOnParentClose setting.",{promoteFirstChildAsParentOnParentClose:a});let s=!1;if(a){l.check("promoteFirstChildAsParentOnParentClose is true, check if the first tab node below currentTabNode is new child node.");let e=c+1;if(e!==n.index&&e<t.length){let a=t[e];w(a)<w(n)&&a.ancestralNodeIds.includes(r.id)&&(n.ancestralNodeIds=[a.id,...a.ancestralNodeIds],s=!0)}}if(s||(n.ancestralNodeIds=[r.id,...r.ancestralNodeIds]),o&&u(t,n),b(),!a){l.stop("End.");break}e=!0}}if((r.directChildrenNodeIds.includes(n.id)||r.directChildrenNodeIds.includes(null!==(s=n.previousTabId)&&void 0!==s?s:-1))&&n.ancestralNodeIds[0]!==r.id){l.check("currentTabNode is the direct parent of tabNode, but not in tabNode.ancestralNodeIds. Update tabNode.ancestralNodeIds with currentTabNode and its ancestralNodeIds."),n.ancestralNodeIds=[r.id,...r.ancestralNodeIds],b(),l.stop("End.");break}if(0===r.ancestralNodeIds.length){e||!(n.ancestralNodeIds.length>0)||n.ancestralNodeIds.includes(r.id)||(l.check("'currentTabNode is at root level, but it is not in tabNode.ancestralNodeIds. All tab node's ancestors are gone. Empty tabNode.ancestralNodeIds'"),n.ancestralNodeIds=[],u(t,n),b()),l.stop("Reach first root level currentTabNode. End.");break}--c<0&&(e||(l.check(`nodeIndex(${c}) < 0, could not find any the parent. Empty "tabNode.ancestralNodeIds".`),n.ancestralNodeIds=[],b()),l.stop("End."))}l.ge()}l.end("fixTabNodeMissingAncestors complete"),l.ge()})(r,n,a,t),e),e),n.ge()}function u(e,t){let n=(0,i.tZ)(!1,i.W4.script,u.name);if(n.gP(),n.search(`Check if tabNode is collapsed, we have to expand it: ${t.areChildrenExpanded?" and all it descendants":""}, otherwise there will be no way to do it since parent is missing.`),t.isExpanded){n.false("tabNode is already expanded. Do nothing.");return}n.check("tabNode is collapsed. Expand it."),t.isExpanded=!0,n.update("tabNode and its updated to collapsed."),function e(t,n,r){(0,i.tZ)(!1,i.W4.script,e.name).log(`${t?"Expand":"Collapse"} tabNode descendants.`),r.areChildrenExpanded=t,n.filter(e=>e.ancestralNodeIds.includes(r.id)).forEach(e=>{e.isExpanded=t})}(t.areChildrenExpanded,e,t),n.ge()}function h(e){return e.index+e.descendantNodesCount+1}function b(e,t){let n=e.index+1;for(;n<t.length;){let e=function(e,t,n=!1){return p(t,t=>t.index===e,n)}(n,t);if(!e||0===w(e))break;n++}return n}function g(e,t,n=!1){let r=e.findIndex(e=>e.id===t);if(-1!==r){let t=e[r];return -1!==r&&n&&e.splice(r,1),t}}function f(e,t,n=!1){let r=e.findIndex(e=>"groupNode"===e.nodeType&&e.id===t);if(-1!==r){let t=e[r];return n&&e.splice(r,1),t}}function p(e,t,n=!1){let r=e.findIndex(e=>x(e)&&t(e));if(-1!==r){let t=e[r];return -1!==r&&n&&e.splice(r,1),t}}function m(e,t,n=!1){return p(t,t=>t.id===e,n)}function y(e,t){return null==e?void 0:e.map(e=>{let n=structuredClone(e);return null==t||t(n),n})}function N(e,t){return s.A.disableLogger?e:y(e,t)}function w(e){return e.ancestralNodeIds.length}function I(e){return(null==e?void 0:e.groupId)!==chrome.tabGroups.TAB_GROUP_ID_NONE}function v(e,t){return e.ancestralNodeIds.includes(t.id)}function C(e,t){let n;let o=(0,i.tZ)(!1,i.W4.script,"updateByTabNodeSelfProperties");o.gP({updatingTabNode:e,partialProperties:t});let s=x(e)?r.Wf:function(e){return(null==e?void 0:e.nodeType)==="groupNode"}(e)?r.WL:void 0;if(s){for(n in t){if(!s.includes(n))continue;let r=(0,a.nH)(e,n),i=Object.getOwnPropertyDescriptor(e,n);o.log({key:n,desc:i,isWritable:r}),r&&(e[n]=t[n])}o.ge()}}function T(e){return Object.assign(Object.assign({},e),{directChildrenNodeIds:[],areChildrenExpanded:!0,isExpanded:!0})}function x(e){return(null==e?void 0:e.nodeType)==="tabNode"}function A(e){return p(e,e=>e.active)}async function k(e){let t=p(e,e=>x(e)&&e.url===o.o7);await chrome.tabs.create({url:o.T8,active:!0,openerTabId:null==t?void 0:t.id})}function E(e,t){return t.find(t=>t.id===e.directChildrenNodeIds[0])}function O(e,t){return t.findLast(t=>x(t)&&t.groupId===e.id)}function P(e,t){return e.map(e=>{for(let n=0;n<t.length;n++)e=t[n](e);return e})}}}]);